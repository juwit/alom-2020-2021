:source-highlighter: pygments
:prewrap!:

:icons: font

:iconfont-cdn: https://use.fontawesome.com/releases/v5.4.2/css/all.css

:toc: left
:toclevels: 4

:linkattrs:

:sectlinks:
:sectanchors:
:sectnums:

:experimental:

:stem:

= ALOM - TP 10 - Rendu !

== Pr√©sentation et objectifs

Le but est de finaliser le d√©veloppement de notre architecture "√† la microservice".

.Notre architecture !
image::images/battle-architecture.png[]

TIP: Pendant ce TP, nous terminons les TP pr√©c√©dents !

Pour pratiquer encore, je vous propose √©galement d'ajouter le gain d'XP, les multiplicateurs de type, et une boutique √† notre jeu !

== Gain d'XP

Avec l'arriv√©e des combats, on constate que les statistiques de nos cher Pokemon sont importantes.
Les combats successifs mettent les Pokemon et leurs dresseurs √† rude √©preuve.

Ajoutez la statistique "experience" aux Pokemons, dans l'API Trainer.
La statistique "level" devient une propri√©t√© calcul√©e.

Le niveau du Pokemon "level" est la racine cubique du nombre de points d'exp√©rience (arrondi √† l'inf√©rieur).
√Ä l'inverse, un pokemon d'un certain niveau poss√®de en points d'exp√©rience la valeur du niveau au cube.

Par exemple, Ondine (Misty), poss√®de un Stari et un Staross, de niveaux 18 et 21.
Stari a donc 18¬≥ points d'exp√©rience, soit 5832.
Staross a 21¬≥ points d'xp, soit 9261.

Avec 6245 points d'exp√©rience, Pikachu est au niveau 18 √©galement. Pour passer au niveau 19, il lui faudra 19¬≥-6245 points d'XP suppl√©mentaire.

Les niveaux des Pokemons sont limit√©s √† 100 pour un nombre d'XP maximum de 1 000 000.

Le gain d'exp√©rience lors d'un combat est r√©gi par la formule suivante :

`1.5*(baseExperience)*(level pokemon vaincu)`

Quand Pikachu met KO le Stari d'Ondine, il gagne `1.5 * 112 * 18 = 3024` points d'exp√©rience

L'exp√©rience des Pokemon grandi √† chaque combat, et leur niveau avec.

Dans l'API Battle, lorsqu'un Pokemon en met KO un autre, modifiez l'exp√©rience du Pokemon qui a gagn√© avec ces formules,
et sauvegardez la nouvelle information dans l'API Trainer (via un PUT HTTP, ou un message AMQP)

== Multiplicateurs de type

NOTE: Cette partie n'est pas not√©e, c'est pour vous occuper si vous le souhaitez :)

Lorsqu'un Pokemon en attaque un autre, les d√©gats inflig√©s d√©pendent √©galement du type de pokemon attaquant / d√©fenseur.

Voici le tableau de multiplicateur de d√©gats en fonction des types attaquants / d√©fenseurs:

image::images/type-table.png[]

Appliquez les modificateurs de type dans votre `battle-api` !

== La boutique

Les dresseurs de Pokemon ont un portefeuille virtuel compos√© de Pok√©-Dollar üí∞.

Ils peuvent cr√©diter leur portefeuille en achetant des Pok√©-Dollar, au taux de change d'1 euro pour 20 000 üí∞.
Chaque dresseur d√©marre avec la somme de 10 000 üí∞ offerts.
Un dresseur qui se cr√©e un compte, peut aussi √©galement choisir un Pokemon offert parmi les 3 starters (id 1, 4, 7).

Une boutique leur permet :

* d'acheter des Pokeballs contenant des Pokemons al√©atoires !
* d'acheter des bonbons pour augmenter le niveau d'un Pokemon !

Voici quelques objets disponibles dans la boutique:

|===
| Super Bonbon | Augmente le niveau d'un Pokemon ! | 5 000 üí∞
| Pokeball | Contient un Pokemon al√©atoire commun de niveau 5 | 10 000 üí∞
| SuperBall | Contient un Pokemon al√©atoire non-commun de niveau 10 | 25 000 üí∞
| HyperBall | Contient un Pokemon al√©atoire rare de niveau 20 | 50 000 üí∞
| MasterBall | Contient un Pokemon al√©atoire l√©gendaire (un seul achat max par dresseur) de niveau 40 | 100 000 üí∞
|===

L'achat d'une PokeBall, SuperBall, HyperBall ou MasterBall a pour effet d'ajouter le Pokemon √† la liste des Pokemon du dresseur.

.Ids de raret√© des Pok√©mons (probabilit√©s √©gales pour chaque id)
|===
| Pokemons communs | 10 13 16 19 41 133 48 43 129 96 52 21 69 46 98 116
| Pokemons non-communs | 35 32 29 23 104 118 60 90 39 81 92 102 79 54 124 120 72 132
| Pokemons rares | 147 58 74 95 77 37 109 27 126 63 25 125 66 88 111 100 108 123 127 114 138 140
| Pokemons l√©gendaires | 144 145 146 150 151
|===

Le lien pour cr√©er le squelette de votre projet sur Github est le suivant : https://classroom.github.com/a/xDwKnkab

La boutique doit :

* g√©rer le portefeuille de chaque dresseur, et lui permettre de l'approvisionner via une API REST
* exposer une API REST consommable par le `game-ui` pour afficher la liste des produits
* mettre √† jour l'√©quipe du dresseur lors d'un achat (avec un PUT REST ou un message AMQP)

== Modalit√©s de la s√©ance

Pendant cette s√©ance, j'attends de chacun de vous :

* un pr√©sentation rapide de votre avancement sur les TP
* parcourir un peu les codes compliqu√©s (battle-api)
* les points de difficult√© rencontr√©s

== Modalit√©s de rendu

Le rendu se fait via vos repositories Github.

Vous devez push votre code directement sur les repositories qui vous sont affect√©s.

Les repositories seront cl√¥tur√©s le 23 d√©cembre √† 20h. Vous avez donc encore un peu de temps pour finaliser votre projet.

Le projet est bien constitu√© de 7 parties jusqu'√† aujourd'hui, plus une partie suppl√©mentaire dont le sujet est d√©taill√© plus haut :

* pokemon-type-api
* trainer-api
* game-ui
* battle-api
* configuration-api
* configuration-repository
* notification-api
* shop-api

NOTE: Le tp "handcraft" ne fait pas partie du rendu.

Dans chacun des repository :

* le code !
* les tests !!
* une collection Postman pour les API exposant de l'HTTP (pas l'api notification, ni configuration)
* un README.md d√©taillant
** la fa√ßon de lancer le projet localement (commandes maven ? properties √† configurer ?)
** l'url de publication de votre service s'il est publi√© sur un cloud heroku/clever

NOTE: Evitez de commiter/pusher vos r√©pertoires `target` et vos fichiers eclipse/intelliJ `.idea`, `.settings`...
Vous pouvez ajouter un fichier `.gitignore` √† la racine de vos projets pour cela.

== Crit√®res de notation

|===
| API | Fonctionnalit√© | Points

| pokemon-type-api
| types de pokemon traduits, tri√©s, traduits (en+fr), filtre par type
| 1

| trainer-api
| gestion des trainers (GET/POST) avec stockage BDD
| 1

| trainer-api
| API s√©curis√©e en Basic HTTP login + mot de passe1
| 1

| game-ui
| affichage du pokedex traduit, filtrage par type
| 2

| game-ui
| IHM s√©curis√©e (login avec les comptes de trainers)
| 2

| game-ui
| affichage des trainers et de leurs pok√©mons
| 2

| configuration-api / configuration-repository
| configuration des api, gestion de profils
| 1

// socle commun : 10 points

| battle-api
| gestion des combats (cr√©ation/attaque)
| 3

| game-ui
| int√©gration de l'√©cran de jeu
| 1

| shop-api
| achat d'objets et impacts sur le trainer
| 3

| battle-api / trainer-api
| gestion de l'exp√©rience
| 2

| toutes API
| qualit√© globale de code
| 1

// devs suppl√©mentaires : 8 points

|===

== Am√©lioration continue

Aidez moi √† m'am√©liorer !

Pour ce faire, remplissez ce https://forms.gle/9sMf7fk6jtbecPfb8[sondage]
(c'est anonyme! √ßa vous prendra moins de 10 minutes, il y a 8 questions + commentaires libres)
